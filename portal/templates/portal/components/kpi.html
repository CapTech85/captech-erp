{# portal/templates/portal/components/kpi.html #}
{% comment %}
Props attendues:
- title (str)
- value (str/num déjà formaté de préférence)
- meta (str, option)
- delta (str, option) ex: "+4,2 %"
- state (success|warn|danger) -> couleur du point
- tooltip (str, option) -> title sur la card
{% endcomment %}

{% with dot_color="bg-emerald-500" %}
  {% if state == "warn" %}{% set dot_color = "bg-amber-500" %}{% endif %}
  {% if state == "danger" %}{% set dot_color = "bg-rose-500" %}{% endif %}
{% endwith %}

<div class="bg-white rounded-2xl shadow-sm p-5" {% if tooltip %}title="{{ tooltip }}"{% endif %}>
  <div class="flex items-start justify-between gap-3">
    <div>
      <div class="flex items-center gap-2 text-xs text-slate-500">
        <span class="inline-block w-2 h-2 rounded-full {% if state == 'danger' %}bg-rose-500{% elif state == 'warn' %}bg-amber-500{% else %}bg-emerald-500{% endif %}"></span>
        <span>{{ title }}</span>
      </div>
      <div class="text-3xl font-semibold text-slate-900 mt-1">{{ value }}</div>
    </div>
    {% if meta %}
      <div class="text-xs text-slate-400">{{ meta }}</div>
    {% endif %}
  </div>

  {% if delta %}
    <div class="mt-3 text-sm">
      <span class="{% if '-' in delta %}text-rose-600{% else %}text-emerald-600{% endif %}">{{ delta }}</span>
      <span class="text-slate-400">vs mois précédent</span>
    </div>
  {% endif %}
</div>
